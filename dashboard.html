<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Power Star | Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { 
            --gold: #fbbf24; --gold-dark: #d97706; --bg: #0a0e1a; 
            --card: #1a1f35; --border: #2d3548; --card-dark: #151929;
            --text-secondary: #94a3b8;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; margin: 0; padding-bottom: 100px; overflow-x: hidden; }
        
        .header { padding: 20px; background: #131829; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        
        /* User ID Badge Style */
        .user-meta { display: flex; align-items: center; justify-content: space-between; padding: 10px 20px; background: #0f1423; font-size: 12px; border-bottom: 1px solid var(--border); }
        .id-badge { background: rgba(251, 191, 36, 0.1); color: var(--gold); padding: 4px 10px; border-radius: 8px; border: 1px solid rgba(251, 191, 36, 0.3); font-weight: 700; }

        .balance-card { 
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%); 
            padding: 30px 25px; border-radius: 24px; margin: 20px; 
            box-shadow: 0 15px 35px rgba(217, 119, 6, 0.2);
            text-align: center;
        }

        .news-box { 
            margin: 0 20px 25px; 
            background: rgba(251, 191, 36, 0.1); 
            border: 1px solid rgba(251, 191, 36, 0.3); 
            padding: 10px; border-radius: 12px; 
            display: flex; align-items: center;
        }
        .news-box marquee { font-size: 13px; font-weight: 600; color: #fff; }

        .media-container { 
            margin: 0 20px; 
            background: var(--card); 
            border-radius: 24px; 
            padding: 12px; 
            border: 1px solid var(--border);
        }
        .media-content { 
            width: 100%; height: 220px; background: #000; border-radius: 16px; overflow: hidden; 
            display: flex; align-items: center; justify-content: center; border: 1px solid var(--border);
        }
        .media-content img, .media-content video { width: 100%; height: 100%; object-fit: cover; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #131829; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-link { color: var(--text-secondary); text-decoration: none; font-size: 10px; text-align: center; }
        .nav-link i { font-size: 20px; display: block; margin-bottom: 4px; }
        .nav-link.active { color: var(--gold); }
    </style>
</head>
<body>

    <div class="header">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 style="font-weight:800; font-size: 20px; margin:0;">POWER <span style="color:var(--gold)">STAR</span></h2>
            <div style="display: flex; gap: 15px; align-items: center;">
                <i class="fa-solid fa-headset" style="color: var(--gold); font-size: 18px;"></i>
                <i class="fa-solid fa-right-from-bracket" onclick="logout()" style="color: #ef4444; font-size: 18px; cursor:pointer;"></i>
            </div>
        </div>
    </div>

    <div class="user-meta">
        <span id="u-name" style="font-weight: 600; color: var(--text-secondary);">Loading...</span>
        <span class="id-badge" id="u-id">PS####</span>
    </div>

    <div class="balance-card">
        <p style="font-size:13px; font-weight:600; opacity:0.8; margin-bottom:5px;">Available Balance</p>
        <h1 style="font-size:35px; font-weight:900; margin:0;">Rs. <span id="u-bal">0.00</span></h1>
    </div>

    <div class="news-box">
        <span style="background:var(--gold); color:#000; padding:3px 8px; border-radius:6px; font-size:10px; font-weight:800; margin-right:10px;">NEWS</span>
        <marquee id="news-text">Syncing with server...</marquee>
    </div>

    <div class="media-container">
        <div class="media-content" id="media-content">
            <i class="fa-solid fa-circle-notch fa-spin" style="font-size:40px; color:var(--gold); opacity:0.5;"></i>
        </div>
    </div>

    <nav class="nav-bar">
        <a href="dashboard.html" class="nav-link active"><i class="fa-solid fa-house"></i>Home</a>
        <a href="marketing.html" class="nav-link"><i class="fa-solid fa-chart-simple"></i>Marketing</a>
        <a href="team.html" class="nav-link"><i class="fa-solid fa-users-viewfinder"></i>Team</a>
        <a href="wallet.html" class="nav-link"><i class="fa-solid fa-wallet"></i>Wallet</a>
    </nav>
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwo-zF_6Vs4nWpfgienzvQ_M1fdRa5ybR4Jt4vBtrlxDEBac6JELKmX-PX-ISIABFEa/exec";

async function syncDashboard() {
    const localUser = JSON.parse(localStorage.getItem("ps_user"));
    if (!localUser) { window.location.href = "index.html"; return; }

    // Pehle local data dikhao taake screen khali na lage
    document.getElementById("u-name").innerText = localUser.name;
    document.getElementById("u-id").innerText = localUser.user_id || "PS-User";
    document.getElementById("u-bal").innerText = localUser.balance || "0.00";

    try {
        const res = await fetch(API_URL);
        const data = await res.json();

        // 1. User Balance aur ID Sync karein
        if (data.users) {
            const dbUser = data.users.find(u => String(u.number) === String(localUser.number));
            if(dbUser) {
                document.getElementById("u-bal").innerText = dbUser.balance || "0.00";
                document.getElementById("u-id").innerText = dbUser.user_id;
                localStorage.setItem("ps_user", JSON.stringify(dbUser));
            }
        }

        // 2. News Update (Settings Sheet se)
        if(data.settings && data.settings.news) {
            document.getElementById("news-text").innerText = data.settings.news;
        }

        // 3. Media Update (Settings Sheet se)
        if(data.settings && data.settings.media_link) {
            const mediaBox = document.getElementById("media-content");
            const type = String(data.settings.media_type).toLowerCase();
            const link = data.settings.media_link;

            if (type === "video") {
                mediaBox.innerHTML = `<video src="${link}" style="width:100%; height:100%; object-fit:cover;" autoplay muted loop playsinline></video>`;
            } else {
                mediaBox.innerHTML = `<img src="${link}" style="width:100%; height:100%; object-fit:cover;">`;
            }
        }
    } catch (e) { 
        console.log("Sync Error:", e);
    }
}

function logout() {
    localStorage.removeItem("ps_user");
    window.location.href = "index.html";
}

window.onload = syncDashboard;
</script>

</body>
</html>
